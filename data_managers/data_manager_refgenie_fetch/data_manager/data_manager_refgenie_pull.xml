<tool id="data_manager_refgenie_pull" name="Refgenie asset pulling" version="0.0.1" tool_type="manage_data" profile="20.05">
    <description>from remote resource</description>
    <requirements>
        <requirement type="package" version="0.9.1">refgenie</requirement>
    </requirements>
    <code file="data_manager_refgenie_pull_code_file.py" />
    <command detect_errors="exit_code"><![CDATA[
       #set ga = str($assets).split('/',2)
       refgenie pull -c '$__app__.config.refgenie_config_file' -g '$ga[1]' '$ga[2]' $force >
       '${out_log}'
       2>&1
       && echo '' > '${out_file}'
    ]]></command>
    <inputs>
        <param argument="--assets" name="assets" type="drill_down" display="radio" hierarchy="exact" multiple="False" optional="False" label="Select desired asset" dynamic_options="galaxy_code_get_refgenie_assets(__trans__.app.config.refgenie_config_file)" help="string of asset-registry-paths">
            <validator type="regex" message="You must select an asset, not the remote URL or genome.">.+/.+/.+</validator>
        </param>
        <param argument="--force" name="force" type="boolean" truevalue="--force" falsevalue="" selected="False" label = "Force (re-)download" />
    </inputs>
    <outputs>
        <data name="out_file" format="data_manager_json"/>
        <data name="out_log" format="txt"/>
    </outputs>
    <tests>
        <!-- TODO: need some way to test that new entry was added to data table -->
        <test>
            <param name="assets" value="hg38_chr22/bwa_index:default"/>
            <output name="out_file" format="data_manager_json" file="out_file.data_manager_json"/>
            <output name="out_log" format="txt" value="out_log.txt"/>
        </test>
    </tests>
    <help>
            **What it does**
            Fetches a reference genome from http://refgenomes.databio.org.
            ------
            .. class:: infomark
            **Notice:** If you leave name, description, or id blank, it will be generated automatically.
    </help>
</tool>
