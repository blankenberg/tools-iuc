<tool id="get_TCGA" name="Download TCGA data" version="1.0">
    <description>DNA Methylation, Expression and Clinical data for all samples of certain cancer type from TCGA</description>
    <macros>
        <import>elmer_macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <command detect_errors="exit_code">
        Rscript "${get_TCGA}"
    </command>
    <configfiles>
        <configfile name="get_TCGA"><![CDATA[
## code chunk: Load all required libraries quietly
library(ELMER, quietly=TRUE, warn.conflicts=FALSE,verbose = FALSE)

## IF disease type NOT available, stop.
if(is.null("${disease}")){
   stop("The disease name should be from TCGA")
}

## Download all TCGA Data
getTCGA("${disease}", Meth="${Meth}",RNA="${RNA}",Clinic="${Clinic}",basedir = "./Data", RNAtype = "${RNAtype_select.RNAtype}",Methfilter = "${Methfilter}")

        ]]></configfile>
    </configfiles>
    <inputs>
        <param name="disease" type="text" value="LUAD" label="Cancer type from TCGA"/>
        <param name="Meth" type="boolean" checked="false" truevalue="TRUE" falsevalue="FALSE" label="Get Methylation Data?" />
        <param name="RNA" type="boolean" checked="false" truevalue="TRUE" falsevalue="FALSE" label="Get Gene Expression Data?" />
        <param name="Clinic"  type="boolean" checked="false" truevalue="TRUE" falsevalue="FALSE" label="Get Clinical Data?" />
        <conditional name="RNAtype_select">
            <param name="RNAtype" type="select" label="Choose RNA type">
                  <option value="gene">Genes</option>
                  <option value="isoform">Isoforms</option>
            </param>
        </conditional>
        <param name="Methfilter" type="float" value="0.2" label="percentage of NA among samples" />
    </inputs>
    <outputs>
        <data name="methylation" format="Rdata" label="${disease}_meth.rda" from_work_dir="./Data" />
        <data name="expression" format="Rdata" label="${disease}_RNA.rda" from_work_dir="./Data" />
        <data name="clinical" format="Rdata" label="${disease}_clinic.rda" from_work_dir="./Data" />
    </outputs>
    <help>
**What it does:**

Download TCGA is a function to download DNA methylation, RNA expression and clinic data for all
samples of certain cancer type from TCGA website. And downloaded data will be transform to
matrixes or data frame for further analysis. The output results in multiple galaxy history items.

**Input:**

*Cancer Type*: A character specifies the disease to download in TCGA such as BLCA,LUAD,LUSC,BRCA etc

*Methylation*: if TRUE HM450K DNA methylation data will download.

*RNA*: if TRUE RNA-seq Hiseq-V2 from TCGA level 3 will be download.

*Clinic*: if TRUE clinic data will be download for that disease.

*RNAtype*: Specify whether use isoform level or gene level. When RNAtype=gene,
gene level gene expression will be used. When RNAtype=isoform, isoform data will
be used.

*Methfilter*: This takes a number between 0 and 1. For each probe, the percentage of NA among the all the samples should smaller than Methfilter.
The default value is set to 0.2 as mentioned in the vignette for the tool.

**Output:**

Download DNA methylation (HM450K)/RNAseq(HiseqV2)/Clinic data for the specified disease
from TCGA.

    </help>
    <expand macro="citations" />
</tool>
